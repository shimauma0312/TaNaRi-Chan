name: ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®é€šçŸ¥

on:
  workflow_run:
    workflows: ["ãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œ", "å“è³ªãƒã‚§ãƒƒã‚¯çµ±åˆ"]
    types:
      - completed

jobs:
  notify-on-failure:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    
    steps:
    - name: ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’é€šçŸ¥
      uses: actions/github-script@v6
      with:
        script: |
          const workflowName = '${{ github.event.workflow_run.name }}';
          const runUrl = '${{ github.event.workflow_run.html_url }}';
          const headSha = '${{ github.event.workflow_run.head_sha }}';
          
          // ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
          await github.rest.repos.createCommitStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            sha: headSha,
            state: 'failure',
            target_url: runUrl,
            description: `${workflowName} ãŒå¤±æ•—ã—ã¾ã—ãŸ`,
            context: 'continuous-integration'
          });
          
          console.log(`âŒ ${workflowName} ãŒå¤±æ•—ã—ã¾ã—ãŸ`);
          console.log(`ğŸ”— è©³ç´°: ${runUrl}`);
  
  notify-on-success:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - name: ãƒ†ã‚¹ãƒˆæˆåŠŸã‚’é€šçŸ¥
      uses: actions/github-script@v6
      with:
        script: |
          const workflowName = '${{ github.event.workflow_run.name }}';
          const runUrl = '${{ github.event.workflow_run.html_url }}';
          const headSha = '${{ github.event.workflow_run.head_sha }}';
          
          // ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®š
          await github.rest.repos.createCommitStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            sha: headSha,
            state: 'success',
            target_url: runUrl,
            description: `${workflowName} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`,
            context: 'continuous-integration'
          });
          
          console.log(`âœ… ${workflowName} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
          console.log(`ğŸ”— è©³ç´°: ${runUrl}`);
